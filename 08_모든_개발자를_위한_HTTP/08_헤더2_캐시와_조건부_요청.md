# μΊμ‹ κΈ°λ³Έ λ™μ‘

- μΊμ‹κ°€ μ—†μΌλ©΄ κ°™μ€ μ”μ²­μ΄λ”λΌλ„ λ™μΌν• ν—¤λ”μ™€ λ°”λ””λ¥Ό λ§λ“¤μ–΄μ„ μ „μ†΅
- μΈν„°λ„· λ„¤νΈμ›ν¬λ” λλ¦¬κ³  λΉ„μ

β‡’ λλ¦° μ‚¬μ©μ κ²½ν—

![Untitled](./img/Lecture08/Untitled.png)

- μµμ΄ μ”μ²­ μ‹, μΊμ‹μ™€ κ΄€λ ¨λ ν—¤λ”λ¥Ό λ³΄λƒ„
- μ‘λ‹µ κ²°κ³Όλ¥Ό μΊμ‹μ— μ €μ¥ (μ μ”ν• μ‹κ°„λ™μ•)

![Untitled](./img/Lecture08/Untitled%201.png)

- λ‘λ²μ§Έ μ”μ²­ μ‹μ—λ” μΊμ‹μ—μ„ μ°Ύμ•„μ„ λ³΄μ—¬μ£ΌκΈ°μ— λ§¤μ° λΉ¨λΌμ§
- μ„Έλ²μ§Έ μ”μ²­μ—μ„ μΊμ‹ μ‹κ°„μ΄ μ΄κ³Όλλ©΄ λ‹¤μ‹ μ”μ²­ν•΄μ•Όν•¨
- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•λ©΄ μ„λ²„λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό λ‹¤μ‹ μ΅°νν•κ³  μΊμ‹λ¥Ό κ°±μ‹ ν•λ”λ°, μ΄λ• λ‹¤μ‹ λ„¤νΈμ›ν¬ λ‹¤μ΄λ΅λ“κ°€ λ°μƒν•¨

π§ λ§μ•½ μΊμ‹κ°€ λ§λ£ λμ—λ”λ°, ν΄λΌμ΄μ–ΈνΈμ μΊμ‹μ™€ μ„λ²„μ λ°μ΄ν„°κ°€ κ°™λ‹¤λ©΄ λ‹¤μ‹ λ‹¤μ΄ λ°›μ„ ν•„μ”κ°€ μμ„κΉ?

# κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­ - Last Modified

- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όν•΄μ„ μ„λ²„μ— λ‹¤μ‹ μ”μ²­ν•λ©΄ μ•„λ λ‘ μƒν™© μ¤‘ ν•λ‚μ„
    1. μ„λ²„μ—μ„ κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•¨
    2. μ„λ²„μ—μ„ κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ

**β‡’ κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­μΌλ΅ ν•΄κ²°ν•¨**

- μΊμ‹ λ§λ£ ν›„μ—λ„ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•μ§€ μ•μ•λ‹¤λ©΄ ν΄λΌμ΄μ–ΈνΈμ λ°μ΄ν„°μ™€ μ„λ²„μ λ°μ΄ν„°κ°€ κ°™λ‹¤λ” μ‚¬μ‹¤μ„ ν™•μΈν•  μ μλ” λ°©λ²•μ΄ ν•„μ”ν•¨
- λ°μ΄ν„° μµμΆ… μμ •μΌμ„ ν—¤λ”μ—μ„ κ΄€λ¦¬ν•¨

![Untitled](./img/Lecture08/Untitled%202.png)

- μμ •μ΄ μ•λλ©΄ http μ‘λ‹µμ„ λ§λ“¤ λ•, *304 Not Modified*λ΅ λ³΄λ‚΄κ³  HTTP Bodyκ°€ μ—†μ

**β‡’ λ„¤νΈμ›ν¬ λ¶€ν•κ°€ μ¤„μ–΄λ“¦**

![Untitled](./img/Lecture08/Untitled%203.png)

![Untitled](./img/Lecture08/Untitled%204.png)

### μ •λ¦¬

- μΊμ‹ μ ν¨ μ‹κ°„μ΄ μ΄κ³Όλμ–΄λ„ μ„λ²„ λ°μ΄ν„°λ§ κ°±μ‹ λμ§€ μ•μ•μΌλ©΄ ***304 Not Modified + ν—¤λ” λ©”νƒ€ μ •λ³΄***λ΅λ§ μ‘λ‹µ (λ°”λ””X)
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ³΄λ‚Έ μ‘λ‹µ ν—¤λ” μ •λ³΄λ΅ λ©”νƒ€ μ •λ³΄λ¥Ό κ°±μ‹ ν•κ³  μΊμ‹μ— μ €μ¥λ λ°μ΄ν„° μ¬ν™μ©
- λ§¤μ° μ‹¤μ©μ μΈ ν•΄κ²°μ±…

# κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­ - ETag

- κ²€μ¦ ν—¤λ” : μΊμ‹ λ°μ΄ν„°μ™€ μ„λ²„ λ°μ΄ν„°κ°€ κ°™μ€μ§€ κ²€μ¦ν•λ” λ°μ΄ν„°
- μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ” : κ²€μ¦ ν—¤μ–΄λ΅ μ΅°κ±΄μ— λ”°λ¥Έ λ¶„κΈ°
    - If-Modified-Since : Last-Modified
    - If-None-Match : ETag
    - μ΅°κ±΄μ— λ§μ΅±ν•λ©΄ 200 OK, μ•„λ‹λ©΄ 304 Not Modified

### Last-Modified, If-Modified-Since λ‹¨μ 

- 1μ΄ λ―Έλ§ λ‹¨μ„λ΅ μΊμ‹ μ΅°μ • λ¶κ°€λ¥
- λ‚ μ§ κΈ°λ°μ λ΅μ§ μ‚¬μ©
- λ‚ μ§λ” λ‹¤λ¥΄μ§€λ§ λ‚΄μ©μ€ κ°™μ€ κ²½μ°
- μ„λ²„μ—μ„ λ³„λ„λ΅ μΊμ‹ λ΅μ§μ„ κ΄€λ¦¬ν•κ³  μ‹¶μ€ κ²½μ° λ¶κ°€ (ex. μ£Όμ„ λ³€κ²½μ€ μ‹ κ²½ μ•μ“Έκ±°μ•Ό)

### ETag(Entity Tag), If-None-Match

![Untitled](./img/Lecture08/Untitled%205.png)

- μΊμ‹μ© λ°μ΄ν„°μ— μ„μμ κ³ μ ν• λ²„μ „ μ΄λ¦„μ„ λ‹¬μ•„λ‘ 
- λ°μ΄ν„°κ°€ λ³€κ²½λλ©΄ μ΄λ¦„μ„ λ°”κΏ”μ„ λ³€κ²½ν•¨ (Hashλ¥Ό λ‹¤μ‹ μƒμ„±)

![Untitled](./img/Lecture08/Untitled%206.png)

- ETagλ§ ν™•μΈν•΄μ„ κ°™μΌλ©΄ μ μ§€, λ‹¤λ¥΄λ©΄ λ‹¤μ‹ λ°›κΈ°

### μ •λ¦¬

- μΊμ‹ μ μ–΄ λ΅μ§μ„ μ„λ²„μ—μ„ μ™„μ „ν κ΄€λ¦¬
    - ETagλ¥Ό μ–Έμ  λ°”κΏ€μ§€!
- ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν μ΄ κ°’μ„ μ„λ²„μ— μ κ³µ

# μΊμ‹μ™€ μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”

### Cache-Control μΊμ‹ μ μ–΄

- Cache-Control : max-age
    - μΊμ‹ μ ν¨μ‹κ°„μ„ λ„£μ–΄μ¤, μ΄ λ‹¨μ„
- Cache-Control : no-cache
    - λ°μ΄ν„°λ” μΊμ‹ν•΄λ„ λμ§€λ§ ν•­μƒ μ›(origin) μ„λ²„μ— κ²€μ¦ν•κ³  μ‚¬μ©
    - μ› μ„λ²„ : μ¤‘κ°„μ— μ°λ¦¬ λμ— λ³΄μ§€ μ•λ” μΊμ‹ ν”„λ΅μ‹ μ„λ²„λ” μ μ™Έν• μ„λ²„
- Cache-Control : no-store
    - λ°μ΄ν„°μ— λ―Όκ°ν• μ •λ³΄κ°€ μμΌλ―€λ΅ μ €μ¥ν•λ©΄ μ•λ¨
    - λ³΄ν†µ μΊμ‹ν•λ©΄ ν•λ“ λ””μ¤ν¬μ— μ €μ¥λ¨
    - λ©”λ¨λ¦¬μ—μ„ μ‚¬μ©ν•κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ 

### Pragma μΊμ‹ μ μ–΄ (ν•μ„ νΈν™)

- Pragma : no-cache
- Http 1.0 ν•μ„ νΈν™μΌλ΅ λ³΄ν†µ κ±°μ μ‚¬μ©ν•μ§€ μ•μ

### Expires μΊμ‹ μ ν¨ κΈ°κ°„ (ν•μ„ νΈν™)

- μΊμ‹ λ§λ£μΌμ„ μ •ν™•ν• λ‚ μ§λ΅ μ§€μ •
- μ΄ λ‹¨μ„κ°€ ν›¨μ”¬ μ μ—°ν•¨ (Cache-Control: max-age κ°€ λ” κ¶μ¥λ¨)
- Expiresλ‘ Cache-Controlμ΄ κ°™μ΄ μμΌλ©΄ Expiresκ°€ λ¬΄μ‹λ¨

### κ²€μ¦ ν—¤λ”μ™€ μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”

- κ²€μ¦ ν—¤λ” (Validator)
    - ETag
    - Last-Modified
- μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”
    - If-Match, If-None-Match : ETag μ‚¬μ©
    - If-Modified-Since, If-Unmodified-Since : Last-Modified μ‚¬μ©

# ν”„λ΅μ‹ μΊμ‹

### μ› μ„λ²„μ— μ§μ ‘ μ ‘κ·Ό vs ν”„λ΅μ‹ μΊμ‹ λ„μ…

**μ› μ„λ²„**

![Untitled](./img/Lecture08/Untitled%207.png)

- κ°κ° λ‹¤ κΈ°λ‹¤λ ¤μ•Όν•΄μ„ μ¤λ κ±Έλ¦Ό

**ν”„λ΅μ‹ μΊμ‹**

![Untitled](./img/Lecture08/Untitled%208.png)

- μ¤‘κ°„ μ–΄λ”κ°€μ— ν”„λ΅μ‹λ¥Ό λ‘ 
- CDN μ„λΉ„μ¤
- μ²«λ²μ§Έ μ μ €λ” λ³΄ν†µ λλ¦Ό

### μΊμ‹ μ§€μ‹μ–΄ (directives)

- Cache-Control: public
  - μ‘λ‹µμ΄ publicμ— μ €μ¥λμ–΄λ„ λ¨
- Cache-Control: private
  - μ‘λ‹µμ΄ ν•΄λ‹Ή μ‚¬μ©μλ§μ„ μ„ν• κ²ƒ
  - privateμ— μ €μ¥ν•΄μ•Όν•¨
- Cache-Control: s-maxage
- Age: 60 (Http ν—¤λ”)
  - μ¤λ¦¬μ§„ μ„λ²„μ—μ„ μ‘λ‹µ ν›„ ν”„λ΅μ‹ μΊλ‹ λ‚΄ λ¨Έλ¬Έ μ‹κ°„ (μ΄ λ‹¨μ„)

# μΊμ‹ λ¬΄ν¨ν™”

- μ›ΉλΈλΌμ°μ €κ°€ μ„μλ΅ μΊμ‹±μ„ ν•  μ λ„ μμ
- ν™•μ‹¤ν• μΊμ‹ λ¬΄ν¨ν™”λ¥Ό μ„ν•΄μ„λ” μ•„λ ν‚¤μ›λ“λ“¤μ„ λ„£μ–΄μ•Όν•¨

```
Cache-Control : no-cache, no-store, must-revalidate
Pragma: no-cache
```

- Cache-Control : no-cache
  - ν•­μƒ μ›μ„λ²„μ— κ²€μ¦
- Cache-Control : no-store
  - μ €μ¥ν•μ§€ λ§κ³  μµλ€ν• λΉ¨λ¦¬ μ‚­μ 
- Cache-Control : must-revalidate
  - μΊμ‹ λ§λ£ ν›„ μµμ΄ μ΅°ν μ‹ μ› μ„λ²„μ— κ²€μ¦ν•΄μ•Όν•¨
  - μ› μ„λ²„ μ ‘κ·Ό μ‹¤ν¨ μ‹ λ°λ“μ‹ μ¤λ¥
- Pragma: no-cache
  - Http 1.0 ν•μ„ νΈν™

κµ¬κΈ€μ€ max-age: 0κΉμ§€ λ“¤μ–΄κ°€μμ (μ”μ¦μ€ ν•μ„ νΈν™μ΄λΌ μ“°μ§€ λ§λΌκ³ ν•¨)

### no-cache vs must-revalidate

- no-cache

![Untitled](./img/Lecture08/Untitled%209.png)

![Untitled](./img/Lecture08/Untitled%2010.png)

- must-revalidate

![Untitled](./img/Lecture08/Untitled%2011.png)