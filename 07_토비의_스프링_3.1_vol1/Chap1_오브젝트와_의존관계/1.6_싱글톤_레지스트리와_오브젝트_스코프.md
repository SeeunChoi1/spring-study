# 1.6 싱글톤 레지스트리와 오브젝트 스코프


>💡 **오브젝트의 동일성과 동등성**
>- identical(==) vs equivalent(equals())
>- 동일 : 하나의 오브젝트만 존재하며 두 갱의 오브젝트 레퍼런스 변수를 가진 것
>- 동등 : 두 개의 각기 다른 오브젝트가 메모리상에 존재함. (단, 기준에 따라 갖다고 판단하는 것)


- userDao를 매번 호출하면 계속해서 새로운 오브젝트가 만들어짐
- 애플리케이션 컨텍스트에 등록하고 등록된 오브젝트를 가져오면 동일한 오브젝트를 땡겨옴

## 1.6.1 싱글톤 레지스트리로서의 애플리케이션 컨텍스트

- 싱글톤 레지스트리 : 싱글톤을 저장하고 관리함
- 자바 엔터프라이즈 기술을 주로 서버환경에서 사용하기 때문
- 애플리케이션 안에 제한된 수, 단 한개의 오브젝트만 만들어 사용
    - 하나만 만들어지는 클래스의 오브젝트는 애플리케이션 내에서 전역적으로 접근이 가능
    - 단일 오브젝트만 존재해야하고 이를 애플리케이션의 여러 곳에서 공유하는 경우 주로 사용

### 싱글톤 패턴의 한계

```java
public class UserDao {
	private static UserDao INSTANCE;

	private UserDao(ConnectionMaker connectionMaker) {
		this.connectionMaker = connectionMaker;
	}

	public static synchronized UserDao getInstance() {
		if (INSTANCE == null) {
			INSTANCE = new UserDao(???);
		}
		return INSTANCE;
	}
}
```

- private 생성자를 갖고 있기 때문에 상속할 수 없다
- 싱글톤은 테스트하기가 어렵다
- 서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다
- 싱글톤의 사용은 전역상태를 만들 수 있기 때문에 바람직하지 못하다

### 싱글톤 레지스트리

- 스프링이 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공
- 평범한 자바 클래스를 싱글톤으로 활용하게 해줌
- **스프링은 IoC 컨테이너일 뿐만 아니라, 고전적인 싱글톤 패턴을 대신해서 싱글톤을 만들고 관리해주는 싱글톤 레지스트리임**

## 1.6.2 싱글톤과 오브젝트의 상태

- 싱글톤은 멀티스레드 환경이라면 여러 스레드가 동시에 접근 가능 → 무상태 stateless로 만들어져야함
- 메소드 파라미터나, 메소드 안에서 생성되는 로컬 변수는 매번 새로운 값을 저장할 독립적인 공간이 만들어지기 때문에, 싱글톤이라고 해도 여러 스레드가 변수의 값을 덮어쓸 일은 없다

  ![Untitled](../img/Chap1/Untitled%2015.png)

- 개별적으로 바뀌는 정보는 로컬 변수로 정의하거나, 파라미터로 주고받으면서 사용하게 해야함
- 읽기전용 정보는 인스턴스 변수로 정의해서 사용 가능
- 단순 읽기전용 값이라면 static final이나 final 로 선언하는 편이 나음

## 1.6.3 스프링 빈의 스코프

- 스코프 : 스프링이 관리하는 오브젝트 즉, 빈이 생성되고, 존재하고, 적용되는 범위
- 싱글톤 스코프는 컨테이너 내에 한 개의 오브젝트만 만들어져서, 강제로 제거하지 않는 한 스프링 컨테이너가 존재하는 동안 계속 유지됨
- 대부분의 빈은 싱글톤 스코프
    - 예외 : 프로토타입 스코프(컨테이너에 빈을 요청할 때마다), 요청 스코프(HTTP 요청 기준), 세션 스코프 (웹의 세션과 스코프가 유사함)
