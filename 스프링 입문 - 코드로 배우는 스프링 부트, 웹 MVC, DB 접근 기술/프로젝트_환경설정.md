# ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ 
### ê°•ì‚¬ : ê¹€ì˜í•œ
### ê°•ì˜ link : [ì¸í”„ëŸ° inflearn.com](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8#)

---

- ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ ìƒì„±
- ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì›¹ ì„œë²„ ì‹¤í–‰
- íšŒì› ë„ë©”ì¸ ê°œë°œ
- ì›¹ MVC ê°œë°œ
- DB ì—°ë™ - JDBC, JPA, ìŠ¤í”„ë§ ë°ì´í„° JPA
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±

### 0. í”„ë¡œì íŠ¸ ì‚¬ìš© ê¸°ìˆ 

- Spring Boot
- Gradle : í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë•¡ê¸°ê³  ë¹Œë“œ ì£¼ê¸°ë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” Tool
- Tomcat
- Hibernate
- Thyneleaf

ì–´ë–»ê²Œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•´ì•¼í•˜ëŠ”ì§€?!?!

---

# ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ ìƒì„±

main > java > ì‹¤ì œ ì†ŒìŠ¤

test > í…ŒìŠ¤íŠ¸ì™€ ê´€ë ¨ëœ ì†ŒìŠ¤

`mavenCentral` ì—ì„œ ê¸°ë³¸ì ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‹¤ìš´ë°›ì•„ì˜´

```
12:43:42 ì˜¤ì „: Executing task ':HelloSpringApplication.main()'...

> Task :compileJava
> Task :processResources
> Task :classes

> Task :HelloSpringApplication.main()

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.6.6)

2022-04-21 00:43:45.652  INFO 81392 --- [           main] h.hellospring.HelloSpringApplication     : Starting HelloSpringApplication using Java 16.0.2 on seunchoi-MacBookAir.local with PID 81392 (/Users/seunchoi/Desktop/JPA/hello-spring/build/classes/java/main started by seunchoi in /Users/seunchoi/Desktop/JPA/hello-spring)
2022-04-21 00:43:45.653  INFO 81392 --- [           main] h.hellospring.HelloSpringApplication     : No active profile set, falling back to 1 default profile: "default"
2022-04-21 00:43:46.023  INFO 81392 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2022-04-21 00:43:46.028  INFO 81392 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2022-04-21 00:43:46.028  INFO 81392 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.60]
2022-04-21 00:43:46.064  INFO 81392 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2022-04-21 00:43:46.065  INFO 81392 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 389 ms
2022-04-21 00:43:46.202  INFO 81392 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2022-04-21 00:43:46.210  INFO 81392 --- [           main] h.hellospring.HelloSpringApplication     : Started HelloSpringApplication in 0.909 seconds (JVM running for 1.102)
2022-04-21 00:44:26.851  INFO 81392 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-04-21 00:44:26.851  INFO 81392 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2022-04-21 00:44:26.852  INFO 81392 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
```

ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°„ ì˜ì¡´ê´€ê³„ë„ í•¨ê»˜ ë•¡ê²¨ì˜´

ì´ì „ì—ëŠ” WAS web serverë¥¼ ì§ì ‘ ì„¤ì¹˜í•´ì„œ java íŒŒì¼ì„ ë°€ì–´ë„£ìŒ

ìš”ì¦˜ì€ embededë¡œ ì›¹ì„œë²„ë¥¼ ë„ì›€

- welcome page ê¸°ëŠ¥

  [Spring Boot Features](https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-welcome-page)

  ìœ„ ë©”ë‰´ì–¼ì—ì„œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•´ì•¼í•¨

- thymeleaf í…œí”Œë¦¿ ì—”ì§„ [Thymeleaf](https://www.thymeleaf.org/)

  ì •ì  í˜ì´ì§€ë¥¼ ë°”ë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë­”ê°€ ë£¨í”„ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ í•  ìˆ˜ ìˆìŒ


# ìŠ¤í”„ë§ ê¸°ë³¸ ë™ì‘

```java
@Controller
public class HelloController {
    @GetMapping("hello")
    public String hello(Model model){
        model.addAttribute("data", "hello!!");
        return "hello";
    }
}
```

- ë·° ë¦¬ì¡¸ë²„ê°€  `resources: templates` +{ViewName}+  `.html` ë¡œ ì „í™˜í•˜ì—¬ í™”ë©´ì„ ì—°ê²°í•¨
- `spring-boot-devtools` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ë©´, html íŒŒì¼ì„ ì»´íŒŒì¼ë§Œ í•´ì£¼ë©´ ì„œë²„ ì¬ì‹œì‘ ì—†ì´
  View íŒŒì¼ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤.

jaríŒŒì¼ í•˜ë‚˜ ìƒì„±í•˜ê³  ì„œë²„ì— ì˜¬ë ¤ì„œ ì‹¤í–‰í•˜ë©´ ë

# ìŠ¤í”„ë§ ì›¹ê°œë°œ ê¸°ì´ˆ

MVC : Model, View, Controller

- ì •ì  ì»¨í…ì¸  : íŒŒì¼ì„(ex. HTML) ê·¸ëŒ€ë¡œ ì›¹ë¸Œë¼ìš°ì €ì— ì „ë‹¬
- MVCì™€ í…œí”Œë¦¿ ì—”ì§„ : ì„œë²„ ë ˆë²¨ì—ì„œ ë­”ê°€ ë³€ê²½
- API : JSONìœ¼ë¡œ clientì— ë°ì´í„° ì „ë‹¬ (ì„œë²„ë¼ë¦¬ í†µì‹ í•  ë•Œ)

## ì •ì  ì»¨í…ì¸ 

- ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§
- ë§µí•‘ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì—†ìœ¼ë©´ ë‚´ë¶€ resourcesì—ì„œ htmlì„ ì°¾ìŒ
- ë­”ê°€ htmlì†ŒìŠ¤ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ë°”ë¡œ ì„œë²„ì— ì „ë‹¬

# MVCì™€ í…œí”Œë¦¿ ì—”ì§„

â‡’ htmlì„ ë‚´ë¦°ë‹¤

- model : ë°ì´í„°
- view : í™”ë©´ì„ ê·¸ë¦¬ëŠ”ë° ì—­ëŸ‰ ì§‘ì¤‘
- controller : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬

```java
@GetMapping("hello-mvc")
  public String helloMVC(@RequestParam("name") String name, Model model){
      model.addAttribute("name", name);
      return "hello-template";
  }
```

```html
<html xmlns:th="http://www.thymeleaf.org">
<body>
<p th:text="'hello ' + ${name}">hello! empty</p>
</body>
</html>
```

## API

â‡’ dataë¥¼ ë°”ë¡œ ë‚´ë¦°ë‹¤

@ResponseBody : httpì— í¬í•¨í•´ì„œ ì£¼ê² ë‹¤ ([https://cheershennah.tistory.com/179](https://cheershennah.tistory.com/179))

```java
@GetMapping("hello-api")
@ResponseBody
public Hello helloApi(@RequestParam("name") String name){
    Hello hello = new Hello();
    hello.setName(name);
    return hello;
}
```

JSONìœ¼ë¡œ ë„˜ê²¨ì¤Œ

- ì—´ê³  ë‹«ëŠ”ê²Œ ì—†ì–´ì„œ xmlì„ JSONì´ ì´ê²¼ë‹¤

- viewResolver ì°¾ì§€ ì•Šê³  JSONë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì„œ HTTP bodyì— ì§ì ‘ ë°˜í™˜
- HttpMessageConvertê°€ ì‘ë™í•¨
    - ê°ì²´ - JsonConverter â‡’ **Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬**
    - ê·¸ëƒ¥ ë¬¸ìì—´ - StringConverter
- í´ë¼ì´ì–¸íŠ¸ì˜ HTTP Accept í•´ë”ì™€ ì„œë²„ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ë°˜í™˜ íƒ€ì…ì„ í†µí•´ `HttpMessageConverter` ì„ íƒ

## ë°±ì—”ë“œ ê°œë°œ

- ì•„ì§ ë°ì´í„° ì €ì¥ì†Œê°€ ì„ ì •ë˜ì§€ ì•ŠìŒ(ê°€ìƒì˜ ì‹œë‚˜ë¦¬ì˜¤)
    - repositoryë¥¼ interfaceë¡œ ë§Œë“¤ê³  êµ¬í˜„ì²´ë¥¼ ê°ˆì•„ë‚„ ìˆ˜ ìˆë„ë¡

      (ex. RDB, NoSQL, JDBC, Mybatics, JPA...)

- íšŒì›ê°€ì…, íšŒì›ì¡°íšŒ, ì „ì²´íšŒì›ì¡°íšŒ

## í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ ì‘ì„±

- Junit : í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± í”„ë ˆì„ì›Œí¬

```java
MemberService memberService;
MemoryMemberRepository memberRepository;

@BeforeEach
public void beforeEach(){
    memberRepository = new MemoryMemberRepository();
    memberService = new MemberService(memberRepository);
}

@AfterEach
public void afterEach(){
    memberRepository.clearStore();
}
```

```java
@Test
void íšŒì›ê°€ì…() {
    //given
    Member member = new Member();
    member.setName("hello");

    //when
    Long savedId = memberService.join(member);

    //then
    Member findMember = memberService.findOne(savedId).get();
    assertThat(member.getName()).isEqualTo(findMember.getName());
}
```

# ìŠ¤í”„ë§ ë¹ˆê³¼ ì˜ì¡´ê´€ê³„(DI)

- ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆ ì˜¬ë¼ê°ˆ ë•Œ ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ê´€ë¦¬
- new ë§¨ë‚ í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ì£¼ì… ë°›ì•„ì„œ ì‚¬ìš©í•´ì•¼í•¨

ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡

ì—°ê²°í•  ë•Œ `@Autowired`ë¥¼ ì“´ë‹¤ (ì„ ì„ ì´ì–´ì£¼ëŠ” ì—­í• )

### 1. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì„¤ì •

- `@Component` ê°€ ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ ë‹¤ ë¶™ì–´ìˆë‹¤.
- ì»´í¬ë„ŒíŠ¸ ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡
- SpringBootApplication í•˜ìœ„ì˜ ë””ë ‰í† ë¦¬ë§Œ ì¶”ì²™í•´ì„œ ë¹ˆìœ¼ë¡œ ë“±ë¡í•¨

> ğŸ’¡ **ìŠ¤í”„ë§ì—ì„œì˜ ì‹±ê¸€í†¤ ë””ìì¸ íŒ¨í„´**
> - ì‹±ê¸€í†¤ : ìœ ì¼í•˜ê²Œ í•˜ë‚˜ë§Œ ë“±ë¡í•˜ì—¬ ê³µìœ 
    > ìŠ¤í”„ë§ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•  ë•Œ, ê¸°ë³¸ìœ¼ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ë“±ë¡í•œë‹¤. ë”°ë¼ì„œ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ë©´ ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë‹¤.
    ì„¤ì •ìœ¼ë¡œ ì‹±ê¸€í†¤ì´ ì•„ë‹ˆê²Œ ì„¤ì •í•  ìˆ˜ ìˆì§€ë§Œ, íŠ¹ë³„í•œ ê²½ìš°ë¥¼ ì œì™¸í•˜ë©´ ëŒ€ë¶€ë¶„ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•œë‹¤.


### 2. ìë°” ì½”ë“œë¡œ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°

```java
package hello.hellospring;

import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SpringConfig {
    @Bean
    public MemberService memberService(){
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository(){
        return new MemoryMemberRepository();
    }
}
```

- ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì–´ì©” ìˆ˜ ì—†ìŒ. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ìœ¼ë¡œ ì˜¬ë ¤ì•¼í•¨.

DIì—ëŠ” í•„ë“œ ì£¼ì…, setter ì£¼ì…, ìƒì„±ì ì£¼ì… ì´ë ‡ê²Œ 3ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. ì˜ì¡´ê´€ê³„ê°€ ì‹¤í–‰ì¤‘ì— ë™ì ìœ¼ë¡œ ë³€í•˜ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ ìƒì„±ì ì£¼ì…ì„ ê¶Œì¥í•œë‹¤.

- setter ì£¼ì…
    ```java
    package hello.hellospring.controller;
    
    import hello.hellospring.service.MemberService;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Controller;
    
    @Controller
    public class MemberController {
    
        private final MemberService memberService;
        
            @Autowired
        public void setMemberService(MemberService memberService){
            this.memberService = memberService;
        }
    }
    ```

- ìƒì„±ì ì£¼ì… ë°©ì‹ì€ ì²˜ìŒ ì¡°ë¦½ ì‹œì ì— ì˜¬ë ¤ì„œ ëì„ ë‚´ì•¼í•¨ â† ì´í›„ì—ëŠ” ë³€ê²½ ëª»í•˜ë„ë¡ ë§‰ëŠ”ë‹¤
- ì‹¤ë¬´ì—ì„œëŠ” ì „í˜•ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ëŠ” ì£¼ë¡œ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ì‚¬ìš©
- ì •í˜•í™” ë˜ì§€ ì•Šê±°ë‚˜, ìƒí™©ì— ë”°ë¼ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•´ì•¼ í•˜ë©´ ì„¤ì •ì„ í†µí•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡
  â‡’ êµ¬í˜„ì²´ ë°”ê¿”ì¹˜ê¸°

- `@Autowired` ë¥¼ í†µí•œ DIëŠ” helloConroller , memberService ë“±ê³¼ ê°™ì´ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ëŠ” ê°ì²´(ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì˜¬ë¼ê°€ëŠ” ê°ì²´)ì—ì„œë§Œ ë™ì‘í•œë‹¤.
    - ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šê³  ë‚´ê°€ ì§ì ‘ ìƒì„±í•œ ê°ì²´ì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - SpringConfigì— ì•„ë¬´ê²ƒë„ ì—†ë‹¤ë©´?! ì§ì ‘ newë¡œ memberServiceìƒì„±

# ì›¹ ê¸°ëŠ¥ ì¶”ê°€

- ë¨¼ì € controllerë¥¼ ë’¤ì§€ê³  ì •ì  ë¦¬ì†ŒìŠ¤ë¥¼ ì‹¤í–‰

## ìŠ¤í”„ë§ DB ì ‘ê·¼ ê¸°ìˆ 

> ì˜ˆì œì—ì„œëŠ” H2 Database ì‚¬ìš©
- ìŠ¤í”„ë§ì€ Dependency Injectionì— íŠ¹í™”ë˜ì–´ìˆì–´ì„œ ê°ˆì•„ë¼ê¸°ê°€ í¸í•˜ë‹¤
- ê°œë°©-íì‡„ ì›ì¹™(OCP, Open-Closed Principle)
    - í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³ , ìˆ˜ì •, ë³€ê²½ì—ëŠ” ë‹«í˜€ìˆë‹¤
- ë‹¤í˜•ì„± : êµ¬í˜„ì²´ë§Œ ë°”ê¾¼ë‹¤

# Spring í†µí•© í…ŒìŠ¤íŠ¸

- `@SpringBootTest`
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ í…ŒìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì‹¤í–‰í•œë‹¤.
- `@Transactional`
    - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— ìˆìœ¼ë©´, í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ì— í•­ìƒ ë¡¤ë°±í•œë‹¤.
    - ì¼ë°˜ ì„œë¹„ìŠ¤ì— ë¶™ì—ˆì„ ë•ŒëŠ” ë¡¤ë°±í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - DBì— ë°ì´í„°ê°€ ë‚¨ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.
    - í…ŒìŠ¤íŠ¸ë¥¼ í•­ìƒ ê°™ì€ ì¼€ì´ìŠ¤ë¡œ ì¤‘ë³µ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

# Spring JDBC Template

- create

```java
SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(jdbcTemplate);
jdbcInsert.withTableName("member").usingGeneratedKeyColumns("id");

Map<String, Object> parameters = new HashMap<>();
parameters.put("name", member.getName());

Number key = jdbcInsert.executeAndReturnKey(new MapSqlParameterSource(parameters));
member.setId(key.longValue());
return member;
```

- select

```java
List<Member> result = jdbcTemplate.query("select * from member where id = ?", memberRowMapper(), id);
return result.stream().findAny();
```

# JPA

- JPAëŠ” ê¸°ì¡´ì˜ ë°˜ë³µ ì½”ë“œëŠ” ë¬¼ë¡ ì´ê³ , ê¸°ë³¸ì ì¸ SQLë„ JPAê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì‹¤í–‰í•˜ë©° ê°œë°œ ìƒì‚°ì„±ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆë‹¤.
- JPAë¥¼ ì‚¬ìš©í•˜ë©´, SQLê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ë¡œ íŒ¨ëŸ¬ë‹¤ì„ì„ ì „í™˜ì„ í•  ìˆ˜ ìˆë‹¤.
- JPAëŠ” ìë°” ì§„ì˜ì˜ ì¸í„°í˜ì´ìŠ¤ì´ê³  ê·¸ êµ¬í˜„ì²´ëŠ” ì—¬ëŸ¬ ì—…ì²´ê°€ ìˆë‹¤. (ex. Hibernate)
- EntityManagerë¥¼ ì£¼ì… ë°›ì•„ì•¼í•¨

    ```java
    private final EntityManager em;
    
    public JpaMemberRepository(EntityManager em) {
        this.em = em;
    }
    ```

- ìŠ¤í”„ë§ì€ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•  ë•Œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , ë©”ì„œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ë©´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤. ë§Œì•½ ëŸ°íƒ€ì„ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë¡¤ë°±í•œë‹¤.

```java
@Override
public Optional<Member> findById(Long id) {
    Member member = em.find(Member.class, id);
    return Optional.ofNullable(member);
}

@Override
public Optional<Member> findByName(String name) {
    // pk ê¸°ë°˜ì´ ì•„ë‹Œ ê²ƒì€ queryë¥¼ ì‘ì„±í•´ì•¼í•¨
    List<Member> result = em.createQuery("select m from Member m where m.name = :name", Member.class)
            .setParameter("name", name)
            .getResultList();

    return result.stream().findAny();
}
```

# Spring Data JPA

> ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” JPAë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

- ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ SpringDataJpaMemberRepository ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡

    ```java
    @Configuration
    public class SpringConfig {
    
        private final MemberRepository memberRepository;
    
        @Autowired
        public SpringConfig(MemberRepository memberRepository) {
            this.memberRepository = memberRepository;
        }
    
        @Bean
        public MemberService memberService(){
            return new MemberService(memberRepository);
        }
    
    //    @Bean
    //    public MemberRepository memberRepository(){
    //        return new MemoryMemberRepository();
    //        return new JdbcMemberRepository(dataSource);
    //        return new JdbcTemplateMemberRepository(dataSource);
    //        return new JpaMemberRepository(em);
    //    }
    }
    ```

- ê³µí†µí™” í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ëª¨ë‘ ê³µí†µí™”í•´ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ê¸°ë³¸ CRUD ì œê³µ
    - extends ì´í›„ëŠ” ë„£ì–´ì¤˜ì•¼í•¨

    ```java
    public interface SpringDataJpaMemberRepository extends JpaRepository<Member, Long>, MemberRepository {
        @Override
        Optional<Member> findByName(String name);
    }
    ```

- í”„ë¡ì‹œë¡œ êµ¬í˜„ì²´ ìƒì„±
    - ì¸í„°í˜ì´ìŠ¤ë§Œ ë§Œë“œë‹ˆê¹Œ ê°œë°œì´ ëë‚¨
    - êµ¬í˜„ì²´ëŠ” ë‚´ê°€ ì•ˆí•¨

# AOP

- ê³µí†µ ê´€ì‹¬ì‚¬í•­ (cross-cutting concern)
- í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê³µí†µ ê´€ì‹¬ì‚¬í•­ì´ ì„ì´ë©´ ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ë‹¤
- ìˆ˜ì •ì´ í•„ìš”í•˜ë©´ ë‹¤ ì°¾ì•„ì„œ ìˆ˜ì •í•´ì¤˜ì•¼í•œë‹¤

```java
package hello.hellospring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.springframework.stereotype.Component;

@Aspect
@Component
public class TimeTraceAop {

    @Around("execution(* hello.hellospring..*(..))") // íƒ€ê²ŒíŒ…, ì–´ë””ì— AOP ì ìš©í• ê±°ì•¼?
    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable{
        long start = System.currentTimeMillis();
        System.out.println("START : " + joinPoint.toString());
        try{
            return joinPoint.proceed();
        }finally {
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("END: " + joinPoint.toString() + " " + timeMs + "ms");
        }
    }
}
```

- ê°€ì§œ spring beanì„ ì˜¬ë¦¼ (í”„ë¡ì‹œ)
- ëŒ€ìƒìœ¼ë¡œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ injectionë°›ì„ ë•Œ í™•ì¸í•´ë³¼ ìˆ˜ ìˆìŒ

    ```java
    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
        System.out.println("memberService = " + memberService.getClass());
    }
    ```

    - DI : ë­”ì§€ ëª¨ë¥´ê²Ÿê³  ë‚œ ê·¸ëƒ¥ ë°›ì•„ì„œ ì“¸ê²Œ
    - ìë°” ì½”ë“œë¥¼ ì•ë’¤ë¡œ ë¶™ì—¬ì£¼ê³  ê·¸ëŸ° ê¸°ìˆ ë„ ìˆìŒ...